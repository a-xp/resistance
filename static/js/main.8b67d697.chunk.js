(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t,n){e.exports=n.p+"static/media/secret-agent.f4720874.svg"},197:function(e,t,n){e.exports=n.p+"static/media/soldier.1cc063fe.svg"},310:function(e,t,n){e.exports=n.p+"static/media/anonymous.6898e435.svg"},311:function(e,t,n){e.exports=n.p+"static/media/captain.fc758069.svg"},312:function(e,t,n){e.exports=n.p+"static/media/captain-red.09706776.svg"},313:function(e,t,n){e.exports=n.p+"static/media/ninja.9ff8d9ba.svg"},314:function(e,t,n){e.exports=n.p+"static/media/bodyguard.fb712ee8.svg"},342:function(e,t,n){e.exports=n(688)},347:function(e,t,n){},472:function(e,t){},474:function(e,t){},506:function(e,t){},507:function(e,t){},687:function(e,t,n){},688:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(48),i=n.n(o),c=(n(347),n(21)),s=n(22),u=n(23),l=n(25),m=n(24),d=n(26),p=n(696),f=n(695),E=n(698),h=n(699),b=n(20),O=n(36),v=n(16),g=n.n(v),N=n(28),j=n(196),S=n.n(j),C=(n(401),{apiKey:"AIzaSyCVuB9PRtMCoDcYNR70NWWtTuJu3GU0FKM",authDomain:"random-role.firebaseapp.com",databaseURL:"https://random-role.firebaseio.com",projectId:"random-role",storageBucket:"random-role.appspot.com",messagingSenderId:"71043698352"});S.a.initializeApp({apiKey:C.apiKey,authDomain:C.authDomain,projectId:C.projectId});var D,R,y=S.a.firestore(),A={NEW:"NEW",STARTED:"STARTED",FINISHED:"FINISHED"},k={BAD:"BAD",GOOD:"GOOD",RANDOM:"RANDOM"},I={CLASSIC:"CLASSIC",AVALON:"AVALON"},T={PREPARE:"PREPARE",VOTE:"VOTE",PROGRESS:"PROGRESS",REJECTED:"REJECTED",SUCCESS:"SUCCESS",FAIL:"FAIL",isTerminal:function(e){return e===T.REJECTED||e===T.SUCCESS||e===T.FAIL}},M={YES:"YES",NO:"NO"},w=n(197),x=n.n(w),P=n(107),F=n.n(P),B=n(310),Y=n.n(B),L=n(311),G=n.n(L),_=n(312),W=n.n(_),U=n(313),V=n.n(U),J=n(314),H=n.n(J),K={RESISTANCE:"RESISTANCE",SPY:"SPY",BODY_GUARD:"BODY_GUARD",COMMANDER:"COMMANDER",FALSE_COMMANDER:"FALSE_COMMANDER",ASSASSIN:"ASSASSIN",UNKNOWN:"UNKNOWN",SPY_DEFECTOR:"SPY_DEFECTOR",DEFECTOR:"DEFECTOR",DEEP_COVER_SPY:"DEEP_COVER_SPY",BLIND_SPY:"BLIND_SPY"},z=(D={},Object(b.a)(D,K.ASSASSIN,{id:K.ASSASSIN,side:k.BAD,title:"Assassin",icon:V.a,core:!0}),Object(b.a)(D,K.FALSE_COMMANDER,{id:K.FALSE_COMMANDER,side:k.BAD,title:"False Commander",icon:W.a,info:"Appears as Commander"}),Object(b.a)(D,K.SPY,{id:K.SPY,side:k.BAD,title:"Government spy",icon:F.a,base:!0}),Object(b.a)(D,K.COMMANDER,{id:K.COMMANDER,side:k.GOOD,title:"Commander",icon:G.a,core:!0,info:"Knows spies"}),Object(b.a)(D,K.BODY_GUARD,{id:K.BODY_GUARD,side:k.GOOD,title:"Bodyguard",icon:H.a,info:"Knows commanders"}),Object(b.a)(D,K.RESISTANCE,{id:K.RESISTANCE,side:k.GOOD,title:"Member of the Resistance",icon:x.a,base:!0}),Object(b.a)(D,K.UNKNOWN,{id:K.UNKNOWN,icon:Y.a}),Object(b.a)(D,K.SPY_DEFECTOR,{id:K.SPY_DEFECTOR,side:k.BAD,title:"Spy Defector",icon:F.a,info:"Might switch side"}),Object(b.a)(D,K.DEFECTOR,{id:K.DEFECTOR,side:k.GOOD,title:"Defector",icon:x.a,info:"Might switch side"}),Object(b.a)(D,K.DEEP_COVER_SPY,{id:K.DEEP_COVER_SPY,side:k.BAD,title:"Deep cover Spy",icon:F.a,info:"Unknown to Commander"}),Object(b.a)(D,K.BLIND_SPY,{id:K.BLIND_SPY,side:k.BAD,title:"Blind Spy",icon:F.a,info:"Unknown to other spies"}),D),q=(R={},Object(b.a)(R,k.BAD,{color:"spy text",title:"The Spies",success:["3 Missions fail","Commander named by the Assassin"]}),Object(b.a)(R,k.GOOD,{color:"resistance text",title:"The Resistance",success:["3 Missions are completed successfully"],fail:["Commander named by the Spies"]}),R);function Q(e,t){var n=function(e){var t,n,a=e.reduce(function(e,t,n){return Object(c.a)({},e,Object(b.a)({},t,[].concat(Object(O.a)(e[t]),[n])))},(t={},Object(b.a)(t,k.BAD,[]),Object(b.a)(t,k.GOOD,[]),Object(b.a)(t,k.RANDOM,[]),t)),r=[].concat(Object(O.a)(X(a[k.GOOD])),Object(O.a)(X(a[k.RANDOM])),Object(O.a)(X(a[k.BAD])));return n={},Object(b.a)(n,k.BAD,r.slice(Z[r.length])),Object(b.a)(n,k.GOOD,r.slice(0,Z[r.length])),n}(e),a=Array(e.length),r=X(n[k.GOOD]),o=X(n[k.BAD]);for([].concat(Object(O.a)(t.filter(function(e){return z[e].core})),Object(O.a)(X(t.filter(function(e){return!z[e].core})))).forEach(function(e){z[e].side===k.GOOD&&r.length?a[r.shift()]=e:z[e].side===k.BAD&&o.length&&(a[o.shift()]=e)});r.length>0;)a[r.shift()]=K.RESISTANCE;for(;o.length>0;)a[o.shift()]=K.SPY;return a}function X(e){for(var t=e.slice(),n=t.length-1;n>0;n--){var a=Math.floor(Math.random()*(n+1)),r=[t[a],t[n]];t[n]=r[0],t[a]=r[1]}return t}var Z={5:3,6:4,7:4,8:5,9:6,10:6,11:7};function $(e,t){switch(e){case K.SPY:case K.FALSE_COMMANDER:case K.ASSASSIN:case K.DEEP_COVER_SPY:return z[t].side===k.GOOD?K.RESISTANCE:K.SPY;case K.BODY_GUARD:return t===K.COMMANDER||t===K.FALSE_COMMANDER?K.COMMANDER:K.UNKNOWN;case K.COMMANDER:return t===K.DEEP_COVER_SPY?K.RESISTANCE:z[t].side===k.GOOD?K.RESISTANCE:K.SPY;default:return K.UNKNOWN}}function ee(e){return 2===e.filter(function(e){return e===K.SPY_DEFECTOR||e===K.DEFECTOR}).length?[Math.ceil(7*Math.random()),Math.ceil(7*Math.random())]:[]}function te(e){return e.map(function(e){return e.role===K.DEFECTOR?Object(c.a)({},e,{role:K.SPY_DEFECTOR}):e.role===K.SPY_DEFECTOR?Object(c.a)({},e,{role:K.DEFECTOR}):e})}var ne=n(143),ae=n.n(ne);var re={vote:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.YES,a=Object(c.a)({},t);return e.forEach(function(e,t){e.bot&&(a[t]=n)}),a},createBot:function(){var e=ae.a.make("{{adjective}} {{noun}}");return{login:e[0].toUpperCase()+e.slice(1),prefSide:k.RANDOM,bot:!0}},doMission:function(e,t){},proposeTeam:function(e,t,n){for(var a=[],r=0;r<oe[e.length][n];r++){var o=t+r;o>=e.length&&(o-=e.length),a.push(o)}return a}},oe={5:[2,3,2,3,3],6:[2,3,4,3,4],7:[2,3,3,4,4],8:[3,4,4,5,5],9:[3,4,4,5,5],10:[3,4,4,5,5],11:[3,4,4,6,5]};function ie(e){var t;return e.reduce(function(e,t){return t.status===T.FAIL?Object(c.a)({},e,Object(b.a)({},k.BAD,1+e[k.BAD])):t.status===T.SUCCESS?Object(c.a)({},e,Object(b.a)({},k.GOOD,1+e[k.GOOD])):e},(t={},Object(b.a)(t,k.GOOD,0),Object(b.a)(t,k.BAD,0),t))}function ce(e,t){var n,a,r=e?e.status===T.REJECTED?e.num:e.num+1:0,o=e?(n=e.leader,a=t.length,n<a-1?n+1:0):Math.floor(Math.random()*t.length);return{num:r,leader:o,participants:t[o].bot?re.proposeTeam(t,o,r):[],vote:[],status:t[o].bot?T.VOTE:T.PREPARE,name:ae.a.make("{{adjective}} {{noun}}")}}function se(e,t){var n,a=Object.values(e).reduce(function(e,t){return Object(c.a)({},e,Object(b.a)({},t,1+e[t]))},(n={},Object(b.a)(n,M.YES,0),Object(b.a)(n,M.NO,0),n));return a[M.YES]+a[M.NO]===t&&(a[M.YES]>a[M.NO]?T.PROGRESS:T.REJECTED)}function ue(){return(ue=Object(N.a)(g.a.mark(function e(t,n,a){var r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ne(),e.next=3,y.collection("rooms").add({members:[{login:n,prefSide:a,host:!0,secret:r}],status:A.NEW});case 3:return o=e.sent,e.abrupt("return",{roomId:o.id,secret:r,login:n});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function le(){return(le=Object(N.a)(g.a.mark(function e(t,n,a){var r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.collection("rooms").doc(t),o=Ne(),e.next=4,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var i,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.get();case 2:if((i=e.sent).exists){e.next=5;break}throw new Error("Room not found");case 5:if(!(s=i.data()).members.some(function(e){return e.login===n})){e.next=8;break}throw new Error("Login is in use");case 8:if(s.status===A.NEW){e.next=10;break}throw new Error("The game has been started");case 10:t.update(r,Object(c.a)({},s,{members:[].concat(Object(O.a)(s.members),[{login:n,prefSide:a,secret:o}])}));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",{roomId:t,login:n,secret:o});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function me(){return(me=Object(N.a)(g.a.mark(function e(t){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var a,r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:a=e.sent,(r=a.data()).status===A.NEW&&r.members.length<11&&(o=re.createBot(),t.update(n,Object(c.a)({},r,{members:[].concat(Object(O.a)(r.members),[o])})));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function de(){return(de=Object(N.a)(g.a.mark(function e(t){var n,a,r,o,i;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomId,a=t.login,r=t.secret,o=y.collection("rooms").doc(n),e.next=4,o.get();case 4:if(!(i=e.sent).exists){e.next=14;break}if(!i.get("members").find(function(e){return e.login===a&&e.secret===r})){e.next=11;break}return e.abrupt("return",!0);case 11:return e.abrupt("return",Promise.reject(Error("Invalid credentials")));case 12:e.next=15;break;case 14:return e.abrupt("return",Promise.reject(Error("Room not found")));case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function pe(){return(pe=Object(N.a)(g.a.mark(function e(t){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var a,r,o,i,s,u,l,m,d;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:if(a=e.sent,r=a.data(),!((o=r.members.length)<5||o>11)){e.next=7;break}throw new Error("Number of players should be between 5 and 11");case 7:r.status===A.NEW&&(s=Q(r.members.map(function(e){return e.prefSide}),r.roles),u=ee(s),l=r.members.map(function(e,t){return Object(c.a)({},e,{team:z[s[t]].side,role:s[t],originalRole:s[t]})}),m=ce(null,l),d=Object(c.a)({},r,{members:l,status:A.STARTED,missions:[m],defectorTurn:u,score:(i={},Object(b.a)(i,k.BAD,0),Object(b.a)(i,k.GOOD,0),i)}),t.update(n,d));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function fe(){return(fe=Object(N.a)(g.a.mark(function e(t){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var a,r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:a=e.sent,r=a.data(),t.update(n,Object(c.a)({},r,{status:A.FINISHED}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ee(){return(Ee=Object(N.a)(g.a.mark(function e(t,n){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection("rooms").doc(n),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(n){var r,o,i,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get();case 2:r=e.sent,(o=r.data()).status===A.NEW&&(i=o.members.find(function(e){return e.login===t}))&&(s=o.members.filter(function(e){return e.login!==t}),i.host&&s.length&&(s[0].host=!0),n.update(a,Object(c.a)({},o,{members:s})));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function he(){return(he=Object(N.a)(g.a.mark(function e(t,n){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get();case 2:r=e.sent,(o=r.data()).status===A.NEW&&t.update(a,Object(c.a)({},o,{roles:n}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function be(e,t){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(N.a)(g.a.mark(function e(t,n){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var r,o,i;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get();case 2:r=e.sent,(o=r.data()).status===A.STARTED&&(i=n(o.missions[o.missions.length-1],o),t.update(a,Object(c.a)({},o,{missions:[].concat(Object(O.a)(o.missions.slice(0,o.missions.length-1)),[i])})));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ve(){return(ve=Object(N.a)(g.a.mark(function e(t){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t,function(e,t){return oe[t.members.length][e.num]===e.participants.length?Object(c.a)({},e,{status:T.VOTE}):e});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ge(){return(ge=Object(N.a)(g.a.mark(function e(t,n,a){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t,function(e,t){if(e.vote[n])return e;var r=Object(c.a)({},e.vote,Object(b.a)({},n,a));t.members[n].host&&(r=re.vote(t.members,r,a));var o=se(r,t.members.length);return o?Object(c.a)({},e,{status:o,vote:r}):Object(c.a)({},e,{vote:r})});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ne(){return Math.random().toString(36).replace(/[^a-z]+/g,"")}function je(){return(je=Object(N.a)(g.a.mark(function e(t){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var a,r,o,i,s,u;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:if(a=e.sent,(r=a.data()).status!==A.STARTED){e.next=14;break}if(o=r.missions[r.missions.length-1],!((i=ie(r.missions))[k.GOOD]>=3||i[k.BAD]>=3)){e.next=10;break}return t.update(n,Object(c.a)({},r,{status:A.FINISHED,score:i})),e.abrupt("return");case 10:s=r.members,o.status!==T.REJECTED&&r.defectorTurn.includes(o.num)&&(s=te(s)),u=ce(o,s),t.update(n,Object(c.a)({},r,{score:i,members:s,missions:[].concat(Object(O.a)(r.missions),[u])}));case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Se={create:function(e,t,n){return ue.apply(this,arguments)},join:function(e,t,n){return le.apply(this,arguments)},listenRoom:function(e,t){return y.collection("rooms").doc(e).onSnapshot(t)},login:function(e){return de.apply(this,arguments)},start:function(e){return pe.apply(this,arguments)},end:function(e){return fe.apply(this,arguments)},kick:function(e,t){return Ee.apply(this,arguments)},setRoles:function(e,t){return he.apply(this,arguments)},updateCurrentMission:be,nextMission:function(e){return je.apply(this,arguments)},addBot:function(e){return me.apply(this,arguments)},proposeTeam:function(e){return ve.apply(this,arguments)},voteTeam:function(e,t,n){return ge.apply(this,arguments)}},Ce=n(198),De=n.n(Ce),Re=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={joinErrMsg:[],createErrMsg:[]},n.roomId=window.location.hash.slice(1),n.form=r.a.createRef(),n.joinPane=function(){var e=n.state.joinErrMsg;return r.a.createElement(p.a.Pane,null,r.a.createElement(f.a,{ref:n.form},e&&e.length>0&&r.a.createElement(E.a,{negative:!0},r.a.createElement(E.a.Header,null,"Failed to join the game"),e.map(function(e){return r.a.createElement("p",null,e)})),r.a.createElement(f.a.Field,{label:"Game ID",control:"input",name:"id",defaultValue:n.roomId}),r.a.createElement(f.a.Field,{label:"Your name",control:"input",name:"login",type:"text"}),r.a.createElement(f.a.Group,{grouped:!0},r.a.createElement("label",null,"Choose your side"),r.a.createElement(f.a.Field,{label:"Resistance",control:"input",type:"radio",name:"side",value:k.GOOD}),r.a.createElement(f.a.Field,{label:"Spies",control:"input",type:"radio",name:"side",value:k.BAD}),r.a.createElement(f.a.Field,{label:"Whatever",control:"input",type:"radio",name:"side",defaultChecked:!0,value:k.RANDOM})),r.a.createElement(h.a,{primary:!0,fluid:!0,onClick:n.onJoin},"JOIN")))},n.createPane=function(){var e=n.state.createErrMsg;return r.a.createElement(p.a.Pane,null,r.a.createElement(f.a,{ref:n.form},e&&e.length>0&&r.a.createElement(E.a,{negative:!0},r.a.createElement(E.a.Header,null,"Failed to join the game"),e.map(function(e){return r.a.createElement("p",null,e)})),r.a.createElement(f.a.Group,{grouped:!0},r.a.createElement("label",null,"Choose a game"),r.a.createElement(f.a.Field,{label:"Resistance: Hunter module",control:"input",type:"radio",name:"game",value:I.CLASSIC,defaultChecked:!0}),r.a.createElement(f.a.Field,{label:"Resistance: Assassin module",control:"input",type:"radio",name:"game",value:I.AVALON})),r.a.createElement(f.a.Field,{label:"Your name",control:"input",name:"login"}),r.a.createElement(f.a.Group,{grouped:!0},r.a.createElement("label",null,"Choose your side"),r.a.createElement(f.a.Field,{label:"Resistance",control:"input",type:"radio",value:k.GOOD,name:"side"}),r.a.createElement(f.a.Field,{label:"Spies",control:"input",type:"radio",value:k.BAD,name:"side"}),r.a.createElement(f.a.Field,{label:"Whatever",control:"input",type:"radio",name:"side",value:k.RANDOM,defaultChecked:!0})),r.a.createElement(h.a,{primary:!0,fluid:!0,onClick:n.onCreate},"CREATE")))},n.onJoin=function(){var e=n.props.onEnter,t=De()(o.findDOMNode(n.form.current),{hash:!0});t.login&&t.id&&t.side&&Se.join(t.id,t.login,t.side).then(function(t){e&&e(t)},function(e){n.setState({joinErrMsg:[e.msg||e.message||e||"Unknown error"]})})},n.onCreate=function(){var e=De()(o.findDOMNode(n.form.current),{hash:!0}),t=n.props.onEnter;e.side&&e.login&&e.game&&Se.create(e.game,e.login,e.side).then(function(e){t&&t(e)},function(e){n.setState({createErrMsg:[e.msg||e.message||e||"Unknown error"]})})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(p.a,{panes:[{menuItem:"JOIN",render:this.joinPane},{menuItem:"CREATE",render:this.createPane}]})}}]),t}(r.a.Component),ye=n(700),Ae=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onTabSet;e.onLeave;return r.a.createElement("div",{className:"ui three buttons room-menu"},r.a.createElement("button",{className:"ui button ".concat(this.btnClass(Ve.MEMBERS)),onClick:function(){return t(Ve.MEMBERS)}},r.a.createElement("i",{className:"eye slash icon"})),r.a.createElement("button",{className:"ui button ".concat(this.btnClass(Ve.BOARD)),onClick:function(){return t(Ve.BOARD)}},r.a.createElement("i",{className:"icon users"})," "),r.a.createElement("button",{className:"ui button ".concat(this.btnClass(Ve.HISTORY)),onClick:function(){return t(Ve.HISTORY)}},r.a.createElement("i",{className:"stack exchange icon"})))}},{key:"btnClass",value:function(e){return this.props.tab===e?"secondary":""}}]),t}(r.a.Component),ke=n(697),Ie=n(332),Te=n(58),Me=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.user,a=t.room,o=t.onLeave,i=a.members,c=a.status,s=n.role&&z[n.role],u=s&&q[s.side];return r.a.createElement(r.a.Fragment,null,s&&r.a.createElement("div",{className:"ui fluid card"},r.a.createElement("div",{className:"content"},r.a.createElement("img",{className:"right floated tiny ui image",src:s.icon,alt:s.title}),r.a.createElement("div",{className:"header ".concat(u.color)},s.title),r.a.createElement("div",{className:"meta"},"Allegiance: ",u.title),r.a.createElement("p",null),s.info&&r.a.createElement("p",null,s.info),r.a.createElement("div",null,"Win conditions:",r.a.createElement("ul",null,u.success&&u.success.map(function(e){return r.a.createElement("li",{className:"text success",key:e},e)}),s.fail&&s.fail.map(function(e){return r.a.createElement("li",{className:"text danger",key:e},e)}))))),r.a.createElement(ke.a,{verticalAlign:"middle",size:"large",celled:!0},i.map(function(t){var a=function(e,t,n){switch(e){case A.FINISHED:return n.role;case A.STARTED:return t.login===n.login?n.role:$(t.role,n.originalRole);default:return K.UNKNOWN}}(c,n,t);return r.a.createElement(ke.a.Item,{key:t.login},r.a.createElement(Ie.a,{avatar:!0,src:z[a].icon}),r.a.createElement(ke.a.Content,null,r.a.createElement(ke.a.Header,null,t.login),c!==A.NEW&&r.a.createElement(ke.a.Description,null,z[a].title)),n.host&&c===A.NEW&&r.a.createElement(ke.a.Content,{floated:"right"},r.a.createElement(h.a,{icon:!0,onClick:function(){return e.kick(t.login)},color:"red"},r.a.createElement(Te.a,{name:"thumbs down"}))),n.host&&c!==A.NEW&&t.bot&&r.a.createElement(ke.a.Content,{floated:"right"},r.a.createElement(h.a,{icon:!0,onClick:function(){return e.setVision(t.login)},color:"blue"},r.a.createElement(Te.a,{name:"eye"}))))})),r.a.createElement("div",{className:"ui fluid buttons"},n.host&&c===A.NEW&&r.a.createElement("button",{className:"ui primary button",onClick:function(){return e.addBot()}},"Add bot"),n.bot&&r.a.createElement("button",{className:"ui positive button",onClick:function(){return e.setVision(i.find(function(e){return e.host}).login)}},"Return to host"),r.a.createElement("button",{className:"ui negative button",onClick:o},"Leave")))}},{key:"kick",value:function(e){var t=this.props,n=t.roomId;t.api.kick(e,n)}},{key:"addBot",value:function(){var e=this.props,t=e.roomId;e.api.addBot(t)}},{key:"setVision",value:function(e){this.props.setVision&&this.props.setVision(e)}}]),t}(r.a.Component);n(687);var we=Object.values(z).filter(function(e){return!e.base&&e.side}),xe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.room,a=(t.api,t.roomId),o=t.user,i=n.members,c=n.roles,s=void 0===c?[]:c;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ui large message"},r.a.createElement("div",{className:"content"},r.a.createElement("p",null,"Waiting for other players to join"),r.a.createElement("p",null,r.a.createElement("a",{className:"roomLink",href:"#".concat(a)},"ROOM LINK")))),r.a.createElement("p",null,r.a.createElement("b",null,"People in this room (",i.length,"):")," ",i.map(function(e){return e.login}).join(", ")),r.a.createElement("p",null,r.a.createElement("b",null,"Possible roles:")," ",[K.RESISTANCE,K.SPY].concat(Object(O.a)(s)).map(function(e,t){return[t>0&&", ",r.a.createElement("span",{key:t,className:q[z[e].side].color},z[e].title)]})),o.host&&r.a.createElement("div",{className:"ui form"},we.map(function(t){return r.a.createElement("div",{className:"field",key:t.id},r.a.createElement("div",{className:"ui checkbox",onClick:function(){e.toggleRole(t.id)}},r.a.createElement("input",{type:"checkbox",className:"hidden",checked:s.includes(t.id),value:t.id,onChange:function(){}}),r.a.createElement("label",null,t.title)))}),r.a.createElement("button",{className:"ui fluid positive button",onClick:function(){e.start()}},"Start")))}},{key:"toggleRole",value:function(e){var t=this.props,n=t.room.roles,a=void 0===n?[]:n,r=t.api,o=t.roomId;a.includes(e)?r.setRoles(o,a.filter(function(t){return t!==e})):r.setRoles(o,[].concat(Object(O.a)(a),[e]))}},{key:"start",value:function(){var e=this.props,t=e.room.members,n=e.api,a=e.roomId;t.length>=5&&n.start(a)}}]),t}(r.a.Component),Pe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.room,n=t.missions.length,a=t.missions[n-1],o=t.members;console.log(a);var i=oe[t.members.length][a.num];return r.a.createElement("div",{className:"ui form"},r.a.createElement("h4",{className:"ui dividing header"},"You are the Leader. Choose ",i," operatives for this mission"),o.map(function(t,n){return r.a.createElement("div",{className:"field",key:t.login},r.a.createElement("div",{className:"ui checkbox",onClick:function(){e.toggleParticipant(n)}},r.a.createElement("input",{type:"checkbox",className:"hidden",checked:a.participants.includes(n),value:n,onChange:function(){}}),r.a.createElement("label",null,t.login)))}),a.participants.length===i&&r.a.createElement("button",{className:"ui positive fluid button",onClick:function(){return e.propose()}},"Propose team"))}},{key:"toggleParticipant",value:function(e){var t=this.props,n=t.roomId,a=t.api,r=t.room;a.updateCurrentMission(n,function(t){var n=t.participants,a=oe[r.members.length][t.num];return n.includes(e)?Object(c.a)({},t,{participants:n.filter(function(t){return t!==e})}):n.length<a?Object(c.a)({},t,{participants:[].concat(Object(O.a)(n),[e])}):t})}},{key:"propose",value:function(){var e=this.props,t=e.api,n=e.roomId;t.proposeTeam(n)}}]),t}(r.a.Component),Fe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.room,t=e.missions.length,n=e.missions[t-1];return r.a.createElement(r.a.Fragment,null,n.status===T.PREPARE&&r.a.createElement("div",{className:"ui yellow message"},r.a.createElement("div",{className:"header"},"Waiting for the Leader to propose a team")),n.status===T.VOTE&&r.a.createElement("div",{className:"ui blue message"},r.a.createElement("div",{className:"header"},"Approve or reject this team")),n.status===T.PROGRESS&&r.a.createElement("div",{className:"ui blue message"},r.a.createElement("div",{className:"header"},"Mission is in progress")),n.status===T.REJECTED&&r.a.createElement("div",{className:"ui message"},r.a.createElement("div",{className:"header"},"The team was rejected by the majority")),n.status===T.FAIL&&r.a.createElement("div",{className:"ui red message"},r.a.createElement("div",{className:"header"},"The team has failed your expectations")),n.status===T.SUCCESS&&r.a.createElement("div",{className:"ui green message"},r.a.createElement("div",{className:"header"},"The team was successful")))}}]),t}(r.a.Component),Be=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,n=e.room,a=n.missions.length,o=n.missions[a-1],i=n.members,c=i[o.leader],s=c.login===t.login?t.role:$(t.role,c.role);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Fe,{room:n}),r.a.createElement("h3",{className:"ui header"},r.a.createElement("img",{className:"ui avatar image",src:z[s].icon}),r.a.createElement("div",{className:"content"},"Leader ",c.login,z[s].title&&r.a.createElement("div",{className:"sub header"},z[s].title))),r.a.createElement("div",{className:"content"},"Proposed operatives:"),r.a.createElement("div",{className:"ui list"},o.participants.map(function(e){var n=i[e],a=n.login===t.login?t.role:$(t.role,n.originalRole);return r.a.createElement("div",{className:"item",key:e},r.a.createElement("img",{className:"ui avatar image",src:z[a].icon}),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},n.login),r.a.createElement("div",{className:"description"},z[a].title)))})))}}]),t}(r.a.Component),Ye=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.user,a=t.room,o=(t.api,t.roomId,t.mission.vote),i=(void 0===o?{}:o)[a.members.findIndex(function(e){return e.login===n.login})];return i?i===M.YES?r.a.createElement("div",{className:"ui green message"},r.a.createElement("div",{className:"header"},"You approved the mission. Waiting for other player to vote")):r.a.createElement("div",{className:"ui red message"},r.a.createElement("div",{className:"header"},"You rejected the mission. Waiting for other player to vote")):r.a.createElement("div",{className:"ui fluid buttons"},r.a.createElement("button",{className:"ui red button",onClick:function(){return e.vote(M.NO)}},r.a.createElement("i",{className:"thumbs down icon"}),"Reject"),r.a.createElement("button",{className:"ui green button",onClick:function(){return e.vote(M.YES)}},r.a.createElement("i",{className:"thumbs up icon"}),"Approve"))}},{key:"vote",value:function(e){var t=this.props,n=t.roomId,a=t.api,r=t.room,o=t.user,i=r.members.findIndex(function(e){return e.login===o.login});a.voteTeam(n,i,e)}}]),t}(r.a.Component),Le=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,n=e.room,a=e.mission;if((t.role===K.DEFECTOR||t.role===K.SPY_DEFECTOR)&&n.defectorTurn.includes(a.num)){var o=t.role===K.DEFECTOR?z[K.SPY_DEFECTOR]:z[K.DEFECTOR];return r.a.createElement("div",{className:"ui fluid card"},r.a.createElement("div",{className:"content"},r.a.createElement("img",{className:"right floated small ui image",src:o.icon}),r.a.createElement("div",{className:"header"},"Your allegiance has changed"),r.a.createElement("div",{className:"meta"},"Defector action"),r.a.createElement("div",{className:"description"},"From the next turn you are sided with ",r.a.createElement("b",{className:q[o.side].color},q[o.side].title))))}return null}}]),t}(r.a.Component),Ge=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.mission;return r.a.createElement("div",{className:"ui  divided list"},t.members.map(function(e,t){return r.a.createElement("div",{className:"item",key:e.login},r.a.createElement("div",{className:"right floated content"},n.vote[t]===M.YES?r.a.createElement("i",{className:"thumbs up icon success text"}):r.a.createElement("i",{className:"thumbs down icon danger text"})),r.a.createElement("div",{className:"content"},e.login))}))}}]),t}(r.a.Component),_e=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.user,a=t.room,o=t.api,i=t.roomId,c=a.missions.length,s=a.missions[c-1],u=a.members[s.leader],l=s.status===T.PREPARE&&u.login===n.login;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{className:"ui center aligned header"},"Mission N",s.num+1,' "The ',s.name,'"'),l&&r.a.createElement(Pe,{room:a,api:o,roomId:i}),!l&&r.a.createElement(Be,{room:a,api:o,roomId:i,user:n}),r.a.createElement(Le,{user:n,room:a,mission:s}),s.status===T.VOTE&&r.a.createElement(Ye,{room:a,user:n,api:o,mission:s,roomId:i}),s.status===T.PROGRESS&&n.host&&r.a.createElement("div",{className:"ui fluid buttons"},r.a.createElement("button",{className:"ui red button",onClick:function(){return e.setMissionResult(T.FAIL)}},"Mission fail"),r.a.createElement("button",{className:"ui green button",onClick:function(){return e.setMissionResult(T.SUCCESS)}},"Mission success")),(s.status===T.PROGRESS||T.isTerminal(s.status))&&r.a.createElement(Ge,{room:a,mission:s}),T.isTerminal(s.status)&&n.host&&r.a.createElement("button",{className:"ui fluid primary button",onClick:function(){return e.nextMission()}},"Next mission"))}},{key:"setMissionResult",value:function(e){var t=this.props,n=t.roomId;t.api.updateCurrentMission(n,function(t){return t.status===T.PROGRESS?Object(c.a)({},t,{status:e}):t})}},{key:"nextMission",value:function(){var e=this.props,t=e.roomId;e.api.nextMission(t)}}]),t}(r.a.Component),We=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.room.score;return e[k.BAD]>e[k.GOOD]?r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{className:"ui medium circular image centered",src:z[K.SPY].icon}),r.a.createElement("h2",{className:"ui center aligned header ".concat(q[k.BAD].color)},"The Spies Won")):r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{className:"ui medium circular image centered",src:z[K.RESISTANCE].icon}),r.a.createElement("h2",{className:"ui center aligned header ".concat(q[k.GOOD].color)},"The Resistance Won"))}}]),t}(r.a.Component),Ue=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.api,a=e.roomId,o=e.user,i=t.status;return r.a.createElement(r.a.Fragment,null,i===A.NEW&&r.a.createElement(xe,{room:t,api:n,roomId:a,user:o}),i===A.STARTED&&r.a.createElement(_e,{room:t,api:n,roomId:a,user:o}),i===A.FINISHED&&r.a.createElement(We,{room:t}))}}]),t}(r.a.Component),Ve={BOARD:"BOARD",MEMBERS:"MEMBERS",HISTORY:"HISTORY"},Je=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={room:null,errMsg:null,tab:Ve.BOARD},n.removeListener=null,n.start=function(){n.clearErr();var e=n.state.room,t=n.props.roomId;e.status===A.NEW&&e.members.length>=1&&e.members.length<10&&Se.start(t).catch(function(e){n.setState({errMsg:e.message||"Unknown error"})})},n.end=function(){n.clearErr();var e=n.props.roomId;Se.end(e).catch(function(e){n.setState({errMsg:e.message||"Unknown error"})})},n.clearErr=function(){n.setState({errMsg:null})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.login,a=t.roomId,o=t.setVision,i=this.state,c=i.room,s=i.errMsg,u=i.tab,l=c&&c.members.find(function(e){return e.login===n});return l&&c?r.a.createElement("div",{className:"room"},s&&r.a.createElement("div",{className:"ui negative message room-msg"},r.a.createElement("div",{className:"header"},"Something went wrong"),r.a.createElement("p",null,s)),r.a.createElement("div",{className:"room-content"},u===Ve.MEMBERS&&r.a.createElement(Me,{room:c,user:l,api:Se,roomId:a,onLeave:function(){return e.leave()},setVision:o}),u===Ve.BOARD&&r.a.createElement(Ue,{room:c,user:l,roomId:a,api:Se})),r.a.createElement(Ae,{onTabSet:function(t){return e.setState({tab:t})},tab:u})):r.a.createElement(ye.a,{centered:"true",as:"h5"},"Searching for a room")}},{key:"componentDidMount",value:function(){var e=this,t=this.props.roomId;this.removeListener=Se.listenRoom(t,function(t){e.setState({room:t.data()})})}},{key:"componentWillUnmount",value:function(){this.removeListener&&(this.removeListener(),this.removeListener=null)}},{key:"leave",value:function(){var e=this.props.onLeave;e&&e()}}]),t}(r.a.Component);var He={setCred:function(e){localStorage.setItem("cred",JSON.stringify(e))},getCred:function(){var e=localStorage.getItem("cred");return e?JSON.parse(e):null},clearCred:function(){localStorage.removeItem("cred")}},Ke=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={roomId:null,login:null,secret:null,ready:!1},n.onEnter=function(e){He.setCred(e),n.setState(Object(c.a)({},e))},n.onLeave=function(){He.clearCred(),window.location=""},n.setVision=function(e){n.setState({login:e})},n.tryLogin=function(){var e=window.location.pathname.split("/").filter(Boolean),t=e[e.length-1],a=He.getCred();!a||t&&a.roomId!==t||Se.login(a).then(function(){n.setState(Object(c.a)({},a))}).catch(function(e){console.error("Failed to rejoin the game",e)})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.roomId,n=e.login,a=e.secret;return r.a.createElement(r.a.Fragment,null,!t&&r.a.createElement(Re,{onEnter:this.onEnter}),t&&r.a.createElement(Je,{roomId:t,login:n,secret:a,onLeave:this.onLeave,setVision:this.setVision}))}},{key:"componentDidMount",value:function(){this.tryLogin()}}]),t}(r.a.Component);i.a.render(r.a.createElement(Ke,null),document.getElementById("root"))}},[[342,1,2]]]);
//# sourceMappingURL=main.8b67d697.chunk.js.map