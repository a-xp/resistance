(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{142:function(e,t,a){e.exports=a.p+"static/media/soldier.1cc063fe.svg"},203:function(e,t,a){e.exports=a.p+"static/media/anonymous.6898e435.svg"},204:function(e,t,a){e.exports=a.p+"static/media/captain.fc758069.svg"},205:function(e,t,a){e.exports=a.p+"static/media/captain-red.09706776.svg"},206:function(e,t,a){e.exports=a.p+"static/media/ninja.9ff8d9ba.svg"},207:function(e,t,a){e.exports=a.p+"static/media/bodyguard.fb712ee8.svg"},235:function(e,t,a){e.exports=a(428)},240:function(e,t,a){},427:function(e,t,a){},428:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(37),i=a.n(o),c=(a(240),a(24)),s=a(19),l=a(20),u=a(22),m=a(21),d=a(23),p=a(436),E=a(435),f=a(438),h=a(439),O=a(17),b=a(30),v=a(18),g=a.n(v),N=a(29),j=a(141),S=a.n(j),D=(a(295),{apiKey:"AIzaSyCVuB9PRtMCoDcYNR70NWWtTuJu3GU0FKM",authDomain:"random-role.firebaseapp.com",databaseURL:"https://random-role.firebaseio.com",projectId:"random-role",storageBucket:"random-role.appspot.com",messagingSenderId:"71043698352"});S.a.initializeApp({apiKey:D.apiKey,authDomain:D.authDomain,projectId:D.projectId});var R,C,y=S.a.firestore(),A={NEW:"NEW",STARTED:"STARTED",FINISHED:"FINISHED"},k={BAD:"BAD",GOOD:"GOOD",RANDOM:"RANDOM"},I={CLASSIC:"CLASSIC",AVALON:"AVALON"},M={PREPARE:"PREPARE",VOTE:"VOTE",PROGRESS:"PROGRESS",REJECTED:"REJECTED",SUCCESS:"SUCCESS",FAIL:"FAIL",isTerminal:function(e){return e===M.REJECTED||e===M.SUCCESS||e===M.FAIL}},T="YES",w="NO",x=a(142),P=a.n(x),F=a(80),B=a.n(F),Y=a(203),L=a.n(Y),G=a(204),_=a.n(G),W=a(205),U=a.n(W),V=a(206),J=a.n(V),K=a(207),H=a.n(K),z={RESISTANCE:"RESISTANCE",SPY:"SPY",BODY_GUARD:"BODY_GUARD",COMMANDER:"COMMANDER",FALSE_COMMANDER:"FALSE_COMMANDER",ASSASSIN:"ASSASSIN",UNKNOWN:"UNKNOWN",SPY_DEFECTOR:"SPY_DEFECTOR",DEFECTOR:"DEFECTOR",DEEP_COVER_SPY:"DEEP_COVER_SPY",BLIND_SPY:"BLIND_SPY"},q=(R={},Object(O.a)(R,z.ASSASSIN,{id:z.ASSASSIN,side:k.BAD,title:"Assassin",icon:J.a,core:!0}),Object(O.a)(R,z.FALSE_COMMANDER,{id:z.FALSE_COMMANDER,side:k.BAD,title:"False Commander",icon:U.a,info:"Appears as Commander"}),Object(O.a)(R,z.SPY,{id:z.SPY,side:k.BAD,title:"Government spy",icon:B.a,base:!0}),Object(O.a)(R,z.COMMANDER,{id:z.COMMANDER,side:k.GOOD,title:"Commander",icon:_.a,core:!0,info:"Knows spies"}),Object(O.a)(R,z.BODY_GUARD,{id:z.BODY_GUARD,side:k.GOOD,title:"Bodyguard",icon:H.a,info:"Knows commanders"}),Object(O.a)(R,z.RESISTANCE,{id:z.RESISTANCE,side:k.GOOD,title:"Member of the Resistance",icon:P.a,base:!0}),Object(O.a)(R,z.UNKNOWN,{id:z.UNKNOWN,icon:L.a}),Object(O.a)(R,z.SPY_DEFECTOR,{id:z.SPY_DEFECTOR,side:k.BAD,title:"Spy Defector",icon:B.a,info:"Might switch side"}),Object(O.a)(R,z.DEFECTOR,{id:z.DEFECTOR,side:k.GOOD,title:"Defector",icon:P.a,info:"Might switch side"}),Object(O.a)(R,z.DEEP_COVER_SPY,{id:z.DEEP_COVER_SPY,side:k.BAD,title:"Deep cover Spy",icon:B.a,info:"Unknown to Commander"}),Object(O.a)(R,z.BLIND_SPY,{id:z.BLIND_SPY,side:k.BAD,title:"Blind Spy",icon:B.a,info:"Unknown to other spies"}),R),Q=(C={},Object(O.a)(C,k.BAD,{color:"spy text",title:"The Spies",success:["3 Missions fail","Commander named by the Assassin"]}),Object(O.a)(C,k.GOOD,{color:"resistance text",title:"The Resistance",success:["3 Missions are completed successfully"],fail:["Commander named by the Spies"]}),C);function X(e,t){var a=function(e){var t,a,n=e.reduce(function(e,t,a){return Object(c.a)({},e,Object(O.a)({},t,[].concat(Object(b.a)(e[t]),[a])))},(t={},Object(O.a)(t,k.BAD,[]),Object(O.a)(t,k.GOOD,[]),Object(O.a)(t,k.RANDOM,[]),t)),r=[].concat(Object(b.a)(Z(n[k.GOOD])),Object(b.a)(Z(n[k.RANDOM])),Object(b.a)(Z(n[k.BAD])));return a={},Object(O.a)(a,k.BAD,r.slice($[r.length])),Object(O.a)(a,k.GOOD,r.slice(0,$[r.length])),a}(e),n=Array(e.length),r=Z(a[k.GOOD]),o=Z(a[k.BAD]);for([].concat(Object(b.a)(t.filter(function(e){return q[e].core})),Object(b.a)(Z(t.filter(function(e){return!q[e].core})))).forEach(function(e){q[e].side===k.GOOD&&r.length?n[r.shift()]=e:q[e].side===k.BAD&&o.length&&(n[o.shift()]=e)});r.length>0;)n[r.shift()]=z.RESISTANCE;for(;o.length>0;)n[o.shift()]=z.SPY;return n}function Z(e){for(var t=e.slice(),a=t.length-1;a>0;a--){var n=Math.floor(Math.random()*(a+1)),r=[t[n],t[a]];t[a]=r[0],t[n]=r[1]}return t}var $={5:3,6:4,7:4,8:5,9:6,10:6};function ee(e,t){switch(console.log(e,t),e){case z.SPY:case z.FALSE_COMMANDER:case z.ASSASSIN:case z.DEEP_COVER_SPY:return t===z.SPY_DEFECTOR?z.SPY:q[t].side===k.GOOD?z.RESISTANCE:t;case z.BODY_GUARD:return t===z.COMMANDER||t===z.FALSE_COMMANDER?z.COMMANDER:z.UNKNOWN;case z.COMMANDER:return t===z.DEEP_COVER_SPY?z.RESISTANCE:q[t].side===k.GOOD?z.RESISTANCE:z.SPY;default:return z.UNKNOWN}}function te(e){return 2===e.filter(function(e){return e===z.SPY_DEFECTOR||e===z.DEFECTOR}).length?[Math.ceil(7*Math.random()),Math.ceil(7*Math.random())]:[]}var ae={5:[2,3,2,3,3],6:[2,3,4,3,4],7:[2,3,3,4,4],8:[3,4,4,5,5]};function ne(e){var t;return e.reduce(function(e,t){return t.status===M.FAIL?Object(c.a)({},e,Object(O.a)({},k.BAD,1+e[k.BAD])):t.status===M.SUCCESS?Object(c.a)({},e,Object(O.a)({},k.GOOD,1+e[k.GOOD])):e},(t={},Object(O.a)(t,k.GOOD,0),Object(O.a)(t,k.BAD,0),t))}function re(){return(re=Object(N.a)(g.a.mark(function e(t,a,n){var r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=de(),e.next=3,y.collection("rooms").add({members:[{login:a,prefSide:n,host:!0,secret:r}],status:A.NEW});case 3:return o=e.sent,e.abrupt("return",{roomId:o.id,secret:r,login:a});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oe(){return(oe=Object(N.a)(g.a.mark(function e(t,a,n){var r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.collection("rooms").doc(t),o=de(),e.next=4,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var i,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.get();case 2:if((i=e.sent).exists){e.next=5;break}throw new Error("Room not found");case 5:if(!(s=i.data()).members.some(function(e){return e.login===a})){e.next=8;break}throw new Error("Login is in use");case 8:if(s.status===A.NEW){e.next=10;break}throw new Error("The game has been started");case 10:t.update(r,Object(c.a)({},s,{members:[].concat(Object(b.a)(s.members),[{login:a,prefSide:n,secret:o}])}));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",{roomId:t,login:a,secret:o});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ie(){return(ie=Object(N.a)(g.a.mark(function e(t){var a,n,r,o,i;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.roomId,n=t.login,r=t.secret,o=y.collection("rooms").doc(a),e.next=4,o.get();case 4:if(!(i=e.sent).exists){e.next=14;break}if(!i.get("members").find(function(e){return e.login===n&&e.secret===r})){e.next=11;break}return e.abrupt("return",!0);case 11:return e.abrupt("return",Promise.reject("Invalid credentials"));case 12:e.next=15;break;case 14:return e.abrupt("return",Promise.reject("Room not found"));case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ce(){return(ce=Object(N.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var n,r,o,i,s,l,u;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get();case 2:if(n=e.sent,r=n.data(),!((o=r.members.length)<5||o>10)){e.next=7;break}throw new Error("Number of players should be between 5 and 10");case 7:r.status===A.NEW&&(s=X(r.members.map(function(e){return e.prefSide}),r.roles),console.log(s),l=te(s),u=r.members.map(function(e,t){return Object(c.a)({},e,{team:q[s[t]].side,role:s[t],originalRole:s[t]})}),t.update(a,Object(c.a)({},r,{members:u,status:A.STARTED,missions:[{num:0,status:M.PREPARE,leader:Math.ceil(Math.random()*u.length),participants:[]}],defectorTurn:l,score:(i={},Object(O.a)(i,k.BAD,0),Object(O.a)(i,k.GOOD,0),i)})));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function se(){return(se=Object(N.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var n,r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get();case 2:n=e.sent,r=n.data(),t.update(a,Object(c.a)({},r,{status:A.FINISHED}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function le(){return(le=Object(N.a)(g.a.mark(function e(t,a){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(a),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(a){var r,o,i,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:r=e.sent,(o=r.data()).status===A.NEW&&(i=o.members.find(function(e){return e.login===t}))&&(s=o.members.filter(function(e){return e.login!==t}),i.host&&s.length&&(s[0].host=!0),a.update(n,Object(c.a)({},o,{members:s})));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ue(){return(ue=Object(N.a)(g.a.mark(function e(t,a){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:r=e.sent,(o=r.data()).status===A.NEW&&t.update(n,Object(c.a)({},o,{roles:a}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function me(){return(me=Object(N.a)(g.a.mark(function e(t,a){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var r,o,i;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get();case 2:r=e.sent,(o=r.data()).status===A.STARTED&&(i=a(o.missions[o.missions.length-1]),t.update(n,Object(c.a)({},o,{missions:[].concat(Object(b.a)(o.missions.slice(0,o.missions.length-1)),[i])})));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function de(){return Math.random().toString(36).replace(/[^a-z]+/g,"")}function pe(){return(pe=Object(N.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection("rooms").doc(t),e.next=3,y.runTransaction(function(){var e=Object(N.a)(g.a.mark(function e(t){var n,r,o,i,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get();case 2:if(n=e.sent,(r=n.data()).status!==A.STARTED){e.next=14;break}if(o=r.missions[r.missions.length-1],i=ne(r.missions),console.log(r,i),!(i[k.GOOD]>=3||i[k.BAD]>=3)){e.next=11;break}return t.update(a,Object(c.a)({},r,{status:A.FINISHED,score:i})),e.abrupt("return");case 11:s=r.members,r.defectorTurn.includes(r.num)&&(s=s.map(function(e){return e.role===z.DEFECTOR?z.SPY_DEFECTOR:e.role===z.SPY_DEFECTOR?z.DEFECTOR:e})),t.update(a,Object(c.a)({},r,{score:i,members:s,missions:[].concat(Object(b.a)(r.missions),[{status:M.PREPARE,leader:(l=o.leader,u=r.members.length,l<u-1?l+1:0),participants:[],num:o.status===M.REJECTED?o.num:o.num+1}])}));case 14:case"end":return e.stop()}var l,u},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Ee={create:function(e,t,a){return re.apply(this,arguments)},join:function(e,t,a){return oe.apply(this,arguments)},listenRoom:function(e,t){return y.collection("rooms").doc(e).onSnapshot(t)},login:function(e){return ie.apply(this,arguments)},start:function(e){return ce.apply(this,arguments)},end:function(e){return se.apply(this,arguments)},kick:function(e,t){return le.apply(this,arguments)},setRoles:function(e,t){return ue.apply(this,arguments)},updateCurrentMission:function(e,t){return me.apply(this,arguments)},nextMission:function(e){return pe.apply(this,arguments)}},fe=a(143),he=a.n(fe),Oe=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,i=new Array(n),c=0;c<n;c++)i[c]=arguments[c];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={joinErrMsg:[],createErrMsg:[]},a.roomId=window.location.hash.slice(1),a.form=r.a.createRef(),a.joinPane=function(){var e=a.state.joinErrMsg;return r.a.createElement(p.a.Pane,null,r.a.createElement(E.a,{ref:a.form},e&&e.length>0&&r.a.createElement(f.a,{negative:!0},r.a.createElement(f.a.Header,null,"Failed to join the game"),e.map(function(e){return r.a.createElement("p",null,e)})),r.a.createElement(E.a.Field,{label:"Game ID",control:"input",name:"id",defaultValue:a.roomId}),r.a.createElement(E.a.Field,{label:"Your name",control:"input",name:"login",type:"text"}),r.a.createElement(E.a.Group,{grouped:!0},r.a.createElement("label",null,"Choose your side"),r.a.createElement(E.a.Field,{label:"Resistance",control:"input",type:"radio",name:"side",value:k.GOOD}),r.a.createElement(E.a.Field,{label:"Spies",control:"input",type:"radio",name:"side",value:k.BAD}),r.a.createElement(E.a.Field,{label:"Whatever",control:"input",type:"radio",name:"side",defaultChecked:!0,value:k.RANDOM})),r.a.createElement(h.a,{primary:!0,fluid:!0,onClick:a.onJoin},"JOIN")))},a.createPane=function(){var e=a.state.createErrMsg;return r.a.createElement(p.a.Pane,null,r.a.createElement(E.a,{ref:a.form},e&&e.length>0&&r.a.createElement(f.a,{negative:!0},r.a.createElement(f.a.Header,null,"Failed to join the game"),e.map(function(e){return r.a.createElement("p",null,e)})),r.a.createElement(E.a.Group,{grouped:!0},r.a.createElement("label",null,"Choose a game"),r.a.createElement(E.a.Field,{label:"Resistance Classic",control:"input",type:"radio",name:"game",value:I.CLASSIC,defaultChecked:!0}),r.a.createElement(E.a.Field,{label:"Resistance Avalon",control:"input",type:"radio",name:"game",value:I.AVALON})),r.a.createElement(E.a.Field,{label:"Your name",control:"input",name:"login"}),r.a.createElement(E.a.Group,{grouped:!0},r.a.createElement("label",null,"Choose your side"),r.a.createElement(E.a.Field,{label:"Resistance",control:"input",type:"radio",value:k.GOOD,name:"side"}),r.a.createElement(E.a.Field,{label:"Spies",control:"input",type:"radio",value:k.BAD,name:"side"}),r.a.createElement(E.a.Field,{label:"Whatever",control:"input",type:"radio",name:"side",value:k.RANDOM,defaultChecked:!0})),r.a.createElement(h.a,{primary:!0,fluid:!0,onClick:a.onCreate},"CREATE")))},a.onJoin=function(){var e=a.props.onEnter,t=he()(o.findDOMNode(a.form.current),{hash:!0});t.login&&t.id&&t.side&&Ee.join(t.id,t.login,t.side).then(function(t){e&&e(t)},function(e){a.setState({joinErrMsg:[e.msg||e.message||e||"Unknown error"]})})},a.onCreate=function(){var e=he()(o.findDOMNode(a.form.current),{hash:!0}),t=a.props.onEnter;e.side&&e.login&&e.game&&Ee.create(e.game,e.login,e.side).then(function(e){t&&t(e)},function(e){a.setState({createErrMsg:[e.msg||e.message||e||"Unknown error"]})})},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(p.a,{panes:[{menuItem:"JOIN",render:this.joinPane},{menuItem:"CREATE",render:this.createPane}]})}}]),t}(r.a.Component),be=a(440),ve=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onTabSet;e.onLeave;return r.a.createElement("div",{className:"ui three buttons room-menu"},r.a.createElement("button",{className:"ui button ".concat(this.btnClass(Pe.MEMBERS)),onClick:function(){return t(Pe.MEMBERS)}},r.a.createElement("i",{className:"eye slash icon"})),r.a.createElement("button",{className:"ui button ".concat(this.btnClass(Pe.BOARD)),onClick:function(){return t(Pe.BOARD)}},r.a.createElement("i",{className:"icon users"})," "),r.a.createElement("button",{className:"ui button ".concat(this.btnClass(Pe.HISTORY)),onClick:function(){return t(Pe.HISTORY)}},r.a.createElement("i",{className:"stack exchange icon"})))}},{key:"btnClass",value:function(e){return this.props.tab===e?"secondary":""}}]),t}(r.a.Component),ge=a(437),Ne=a(225),je=a(47),Se=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.room,o=t.onLeave,i=n.members,c=n.status,s=(n.type,a.role&&q[a.role]),l=s&&Q[s.side];return r.a.createElement("div",null,r.a.createElement("h2",{className:"ui center aligned header"},"Roles"),s&&r.a.createElement("div",{className:"ui fluid card"},r.a.createElement("div",{className:"content"},r.a.createElement("img",{className:"right floated tiny ui image",src:s.icon,alt:s.title}),r.a.createElement("div",{className:"header ".concat(l.color)},s.title),r.a.createElement("div",{className:"meta"},l.title),r.a.createElement("p",null),s.info&&r.a.createElement("p",null,s.info),r.a.createElement("p",null,"Win conditions:",r.a.createElement("ul",null,l.success&&l.success.map(function(e){return r.a.createElement("li",{className:"text success",key:e},e)}),s.fail&&s.fail.map(function(e){return r.a.createElement("li",{className:"text danger",key:e},e)}))))),r.a.createElement(ge.a,{verticalAlign:"middle",size:"huge",celled:!0},i.map(function(t){var n=function(e,t,a){switch(e){case A.FINISHED:return a.role;case A.STARTED:return t.login===a.login?a.role:ee(t.role,a.originalRole);default:return z.UNKNOWN}}(c,a,t);return r.a.createElement(ge.a.Item,{key:t.login},r.a.createElement(Ne.a,{avatar:!0,src:q[n].icon}),r.a.createElement(ge.a.Content,null,r.a.createElement(ge.a.Header,null,t.login),c!==A.NEW&&r.a.createElement(ge.a.Description,null,q[n].title)),a.host&&r.a.createElement(ge.a.Content,{floated:"right"},r.a.createElement(h.a,{icon:!0,onClick:function(){return e.kick(t.login)},color:"red"},r.a.createElement(je.a,{name:"thumbs down"}))))})),r.a.createElement("button",{className:"ui fluid negative button",onClick:o},"Leave"))}},{key:"kick",value:function(e){var t=this.props,a=t.roomId;t.api.kick(e,a)}}]),t}(r.a.Component);a(427);var De=Object.values(q).filter(function(e){return!e.base&&e.side}),Re=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.room,n=(t.api,t.roomId),o=t.user,i=a.members,c=a.roles,s=void 0===c?[]:c;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ui large message"},r.a.createElement("div",{className:"content"},r.a.createElement("p",null,"Waiting for other players to join"),r.a.createElement("p",null,r.a.createElement("a",{className:"roomLink",href:"#".concat(n)},"ROOM LINK")))),r.a.createElement("p",null,r.a.createElement("b",null,"People in this room (",i.length,"):")," ",i.map(function(e){return e.login}).join(", ")),r.a.createElement("p",null,r.a.createElement("b",null,"Possible roles:")," ",[z.RESISTANCE,z.SPY].concat(Object(b.a)(s)).map(function(e,t){return[t>0&&", ",r.a.createElement("span",{key:t,className:Q[q[e].side].color},q[e].title)]})),o.host&&r.a.createElement("div",{className:"ui form"},De.map(function(t){return r.a.createElement("div",{className:"field",key:t.id},r.a.createElement("div",{className:"ui checkbox",onClick:function(){e.toggleRole(t.id)}},r.a.createElement("input",{type:"checkbox",className:"hidden",checked:s.includes(t.id),value:t.id,onChange:function(){}}),r.a.createElement("label",null,t.title)))}),r.a.createElement("button",{className:"ui fluid positive button",onClick:function(){e.start()}},"Start")))}},{key:"toggleRole",value:function(e){var t=this.props,a=t.room.roles,n=void 0===a?[]:a,r=t.api,o=t.roomId;n.includes(e)?r.setRoles(o,n.filter(function(t){return t!==e})):r.setRoles(o,[].concat(Object(b.a)(n),[e]))}},{key:"start",value:function(){var e=this.props,t=e.room.members,a=e.api,n=e.roomId;t.length>=5&&a.start(n)}}]),t}(r.a.Component),Ce=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.room,a=t.missions.length,n=t.missions[a-1],o=t.members;console.log(n);var i=ae[t.members.length][n.num];return r.a.createElement("div",{className:"ui form"},r.a.createElement("h4",{className:"ui dividing header"},"You are the Leader. Choose ",i," operatives for this mission"),o.map(function(t,a){return r.a.createElement("div",{className:"field",key:t.login},r.a.createElement("div",{className:"ui checkbox",onClick:function(){e.toggleParticipant(a)}},r.a.createElement("input",{type:"checkbox",className:"hidden",checked:n.participants.includes(a),value:a,onChange:function(){}}),r.a.createElement("label",null,t.login)))}),n.participants.length===i&&r.a.createElement("button",{className:"ui positive fluid button",onClick:function(){return e.propose()}},"Propose team"))}},{key:"toggleParticipant",value:function(e){var t=this.props,a=t.roomId,n=t.api,r=t.room;n.updateCurrentMission(a,function(t){var a=t.participants,n=ae[r.members.length][t.num];return a.includes(e)?Object(c.a)({},t,{participants:a.filter(function(t){return t!==e})}):a.length<n?Object(c.a)({},t,{participants:[].concat(Object(b.a)(a),[e])}):t})}},{key:"propose",value:function(){var e=this.props,t=e.roomId,a=e.api,n=e.room;a.updateCurrentMission(t,function(e){return ae[n.members.length][e.num]===e.participants.length?Object(c.a)({},e,{status:M.VOTE}):e})}}]),t}(r.a.Component),ye=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.room,t=e.missions.length,a=e.missions[t-1];return r.a.createElement(r.a.Fragment,null,a.status===M.PREPARE&&r.a.createElement("div",{className:"ui yellow message"},r.a.createElement("div",{className:"header"},"Waiting for the Leader to propose a team")),a.status===M.VOTE&&r.a.createElement("div",{className:"ui blue message"},r.a.createElement("div",{className:"header"},"Approve or reject this team")),a.status===M.PROGRESS&&r.a.createElement("div",{className:"ui blue message"},r.a.createElement("div",{className:"header"},"Mission is in progress")),a.status===M.REJECTED&&r.a.createElement("div",{className:"ui message"},r.a.createElement("div",{className:"header"},"The team was rejected by the majority")),a.status===M.FAIL&&r.a.createElement("div",{className:"ui red message"},r.a.createElement("div",{className:"header"},"The team has failed your expectations")),a.status===M.SUCCESS&&r.a.createElement("div",{className:"ui green message"},r.a.createElement("div",{className:"header"},"The team was successful")))}}]),t}(r.a.Component),Ae=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.room,n=a.missions.length,o=a.missions[n-1],i=a.members,c=i[o.leader],s=c.login===t.login?t.role:ee(t.role,c.role);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ye,{room:a}),r.a.createElement("h3",{className:"ui header"},r.a.createElement("img",{className:"ui avatar image",src:q[s].icon}),r.a.createElement("div",{className:"content"},"Leader ",c.login,q[s].title&&r.a.createElement("div",{className:"sub header"},q[s].title))),r.a.createElement("div",{className:"content"},"Proposed operatives:"),r.a.createElement("div",{className:"ui list"},o.participants.map(function(e){var a=i[e],n=a.login===t.login?t.role:ee(t.role,a.role);return r.a.createElement("div",{className:"item",key:e},r.a.createElement("img",{className:"ui avatar image",src:q[n].icon}),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"header"},a.login),r.a.createElement("div",{className:"description"},q[n].title)))})))}}]),t}(r.a.Component),ke=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.room,o=(t.api,t.roomId,t.mission.vote),i=(void 0===o?{}:o)[n.members.findIndex(function(e){return e.login===a.login})];return i?i===T?r.a.createElement("div",{className:"ui green message"},r.a.createElement("div",{className:"header"},"You approved the mission. Waiting for other player to vote")):r.a.createElement("div",{className:"ui red message"},r.a.createElement("div",{className:"header"},"You rejected the mission. Waiting for other player to vote")):r.a.createElement("div",{className:"ui fluid buttons"},r.a.createElement("button",{className:"ui red button",onClick:function(){return e.vote(w)}},r.a.createElement("i",{className:"thumbs down icon"}),"Reject"),r.a.createElement("button",{className:"ui green button",onClick:function(){return e.vote(T)}},r.a.createElement("i",{className:"thumbs up icon"}),"Approve"))}},{key:"vote",value:function(e){var t=this.props,a=t.roomId,n=t.api,r=t.room,o=t.user,i=r.members.findIndex(function(e){return e.login===o.login});n.updateCurrentMission(a,function(t){if(t.vote&&t.vote[i])return t;var a,n=t.vote?Object(c.a)({},t.vote):{};n[i]=e;var o=Object.values(n).reduce(function(e,t){return Object(c.a)({},e,Object(O.a)({},t,1+e[t]))},(a={},Object(O.a)(a,T,0),Object(O.a)(a,w,0),a));return o[T]+o[w]===r.members.length?Object(c.a)({},t,{status:o[T]>o[w]?M.PROGRESS:M.REJECTED,vote:n}):Object(c.a)({},t,{vote:n})})}}]),t}(r.a.Component),Ie=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.room,n=e.mission;if((t.role===z.DEFECTOR||t.role===z.SPY_DEFECTOR)&&a.defectorTurn.includes(n.num)){var o=t.role===z.DEFECTOR?q[z.SPY_DEFECTOR]:q[z.DEFECTOR];return r.a.createElement("div",{className:"ui fluid card"},r.a.createElement("div",{className:"content"},r.a.createElement("img",{className:"right floated small ui image",src:o.icon}),r.a.createElement("div",{className:"header"},"Your allegiance has changed"),r.a.createElement("div",{className:"meta"},"Defector action"),r.a.createElement("div",{className:"description"},"From the next turn you are sided with ",r.a.createElement("b",{className:Q[o.side].color},Q[o.side].title))))}return null}}]),t}(r.a.Component),Me=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,a=e.mission;return r.a.createElement("div",{className:"ui  divided list"},t.members.map(function(e,t){return r.a.createElement("div",{className:"item",key:e.login},r.a.createElement("div",{className:"right floated content"},a.vote[t]===T?r.a.createElement("i",{className:"thumbs up icon success text"}):r.a.createElement("i",{className:"thumbs down icon danger text"})),r.a.createElement("div",{className:"content"},e.login))}))}}]),t}(r.a.Component),Te=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.room,o=t.api,i=t.roomId;console.log(n);var c=n.missions.length,s=n.missions[c-1],l=n.members[s.leader],u=s.status===M.PREPARE&&l.login===a.login;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{className:"ui center aligned header"},"Mission ",s.num+1),u&&r.a.createElement(Ce,{room:n,api:o,roomId:i}),!u&&r.a.createElement(Ae,{room:n,api:o,roomId:i,user:a}),s.status===M.VOTE&&r.a.createElement(ke,{room:n,user:a,api:o,mission:s,roomId:i}),s.status===M.PROGRESS&&a.host&&r.a.createElement("div",{className:"ui fluid buttons"},r.a.createElement("button",{className:"ui red button",onClick:function(){return e.setMissionResult(M.FAIL)}},"Mission fail"),r.a.createElement("button",{className:"ui green button",onClick:function(){return e.setMissionResult(M.SUCCESS)}},"Mission success")),(s.status===M.PROGRESS||M.isTerminal(s.status))&&r.a.createElement(Me,{room:n,mission:s}),r.a.createElement(Ie,{user:a,room:n,mission:s}),M.isTerminal(s.status)&&a.host&&r.a.createElement("button",{className:"ui fluid primary button",onClick:function(){return e.nextMission()}},"Next mission"))}},{key:"setMissionResult",value:function(e){var t=this.props,a=t.roomId;t.api.updateCurrentMission(a,function(t){return t.status===M.PROGRESS?Object(c.a)({},t,{status:e}):t})}},{key:"nextMission",value:function(){var e=this.props,t=e.roomId;e.api.nextMission(t)}}]),t}(r.a.Component),we=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.room.score;return e[k.BAD]>e[k.GOOD]?r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{className:"ui medium circular image centered",src:q[z.SPY].icon}),r.a.createElement("h2",{className:"ui center aligned header ".concat(Q[k.BAD].color)},"The Spies Won")):r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{className:"ui medium circular image centered",src:q[z.RESISTANCE].icon}),r.a.createElement("h2",{className:"ui center aligned header ".concat(Q[k.GOOD].color)},"The Resistance Won"))}}]),t}(r.a.Component),xe=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,a=e.api,n=e.roomId,o=e.user,i=t.status;return r.a.createElement(r.a.Fragment,null,i===A.NEW&&r.a.createElement(Re,{room:t,api:a,roomId:n,user:o}),i===A.STARTED&&r.a.createElement(Te,{room:t,api:a,roomId:n,user:o}),i===A.FINISHED&&r.a.createElement(we,{room:t}))}}]),t}(r.a.Component),Pe={BOARD:"BOARD",MEMBERS:"MEMBERS",HISTORY:"HISTORY"},Fe=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={room:null,errMsg:null,tab:Pe.BOARD},a.removeListener=null,a.start=function(){a.clearErr();var e=a.state.room,t=a.props.roomId;e.status===A.NEW&&e.members.length>=1&&e.members.length<10&&Ee.start(t).catch(function(e){a.setState({errMsg:e.message||"Unknown error"})})},a.end=function(){a.clearErr();var e=a.props.roomId;Ee.end(e).catch(function(e){a.setState({errMsg:e.message||"Unknown error"})})},a.clearErr=function(){a.setState({errMsg:null})},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.login,n=t.roomId,o=this.state,i=o.room,c=o.errMsg,s=o.tab,l=i&&i.members.find(function(e){return e.login===a});return l&&i?r.a.createElement("div",{className:"room"},c&&r.a.createElement("div",{className:"ui negative message room-msg"},r.a.createElement("div",{className:"header"},"Something went wrong"),r.a.createElement("p",null,c)),r.a.createElement("div",{className:"room-content"},s===Pe.MEMBERS&&r.a.createElement(Se,{room:i,user:l,api:Ee,roomId:n,onLeave:function(){return e.leave()}}),s===Pe.BOARD&&r.a.createElement(xe,{room:i,user:l,roomId:n,api:Ee})),r.a.createElement(ve,{onTabSet:function(t){return e.setState({tab:t})},tab:s})):r.a.createElement(be.a,{centered:"true",as:"h5"},"Searching for a room")}},{key:"componentDidMount",value:function(){var e=this,t=this.props.roomId;this.removeListener=Ee.listenRoom(t,function(t){e.setState({room:t.data()})})}},{key:"componentWillUnmount",value:function(){this.removeListener&&(this.removeListener(),this.removeListener=null)}},{key:"leave",value:function(){var e=this.props.onLeave;console.log("leave"),e&&e()}}]),t}(r.a.Component);var Be={setCred:function(e){localStorage.setItem("cred",JSON.stringify(e))},getCred:function(){var e=localStorage.getItem("cred");return e?JSON.parse(e):null},clearCred:function(){localStorage.removeItem("cred")}},Ye=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={roomId:null,login:null,secret:null,ready:!1},a.onEnter=function(e){Be.setCred(e),a.setState(Object(c.a)({},e))},a.onLeave=function(){Be.clearCred(),window.location="/"},a.tryLogin=function(){var e=window.location.hash.slice(1),t=Be.getCred();!t||e&&t.roomId!==e||Ee.login(t).then(function(){a.setState(Object(c.a)({},t))})},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.roomId,a=e.login,n=e.secret;return r.a.createElement(r.a.Fragment,null,!t&&r.a.createElement(Oe,{onEnter:this.onEnter}),t&&r.a.createElement(Fe,{roomId:t,login:a,secret:n,onLeave:this.onLeave}))}},{key:"componentDidMount",value:function(){this.tryLogin()}}]),t}(r.a.Component);i.a.render(r.a.createElement(Ye,null),document.getElementById("root"))},80:function(e,t,a){e.exports=a.p+"static/media/secret-agent.f4720874.svg"}},[[235,1,2]]]);
//# sourceMappingURL=main.b2e03b85.chunk.js.map